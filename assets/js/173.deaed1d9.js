(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{765:function(e,t,s){"use strict";s.r(t);var a=s(27),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"installation-on-google-kubernetes-engine-gke"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation-on-google-kubernetes-engine-gke"}},[e._v("#")]),e._v(" Installation on Google Kubernetes Engine (GKE)")]),e._v(" "),s("h2",{attrs:{id:"prerequisites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),s("ul",[s("li",[e._v("Google Cloud account: "),s("a",{attrs:{href:"http://cloud.google.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://cloud.google.com/"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("Install these tools locally if you're not using the Google Cloud Shell steps below:\n"),s("ul",[s("li",[s("a",{attrs:{href:"https://cloud.google.com/sdk/docs#install_the_latest_cloud_tools_version_cloudsdk_current_version",target:"_blank",rel:"noopener noreferrer"}},[e._v("Google Cloud SDK"),s("OutboundLink")],1),e._v(" including gcloud")]),e._v(" "),s("li",[s("code",[e._v("kubectl")]),e._v(" command line tool")])])])]),e._v(" "),s("h2",{attrs:{id:"cluster-setup"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cluster-setup"}},[e._v("#")]),e._v(" Cluster Setup")]),e._v(" "),s("p",[e._v("These steps only need to be completed once per cluster.")]),e._v(" "),s("ol",[s("li",[e._v("Login to your Google Cloud account: "),s("a",{attrs:{href:"https://cloud.google.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://cloud.google.com/"),s("OutboundLink")],1)]),e._v(" "),s("li",[e._v("Go to "),s("code",[e._v("Kubernetes Engine → Clusters → Create Cluster")])]),e._v(" "),s("li",[e._v("Select the "),s("code",[e._v("Configure")]),e._v(" button under the "),s("code",[e._v("Standard")]),e._v(" option")]),e._v(" "),s("li",[e._v("Enter a name and select a "),s("code",[e._v("Location type")]),e._v(" "),s("ul",[s("li",[e._v("The "),s("code",[e._v("Location type")]),e._v(" settings are up to you. The defaults are fine for an initial test.")])])]),e._v(" "),s("li",[e._v("Select "),s("code",[e._v("1.18.16-gke.502")]),e._v(" for the "),s("code",[e._v("Master version")])]),e._v(" "),s("li",[e._v("On the left menu select "),s("code",[e._v("default-pool")])]),e._v(" "),s("li",[e._v("Under "),s("code",[e._v("Size")]),e._v(" set the "),s("code",[e._v("Number of nodes")]),e._v(" entry to 5.  (See "),s("a",{attrs:{href:"#appendix-a-configuring-clustered-storage"}},[e._v("Appendix A")]),e._v(" for details.)")]),e._v(" "),s("li",[e._v("Click "),s("code",[e._v("Create")])]),e._v(" "),s("li",[e._v("Wait for the cluster to initialize. This will take a few minutes. There will be a green check mark when complete.")]),e._v(" "),s("li",[e._v("Click "),s("code",[e._v("Connect")]),e._v(" for your new cluster.")]),e._v(" "),s("li",[e._v("Click "),s("code",[e._v("Run in Cloud Shell")]),e._v(" "),s("ul",[s("li",[e._v("Alternatively, copy the provided command and execute it in your local environment to connect your local "),s("code",[e._v("kubectl")]),e._v(" to your GKE cluster.")])])]),e._v(" "),s("li",[e._v("Run "),s("code",[e._v("kubectl get namespaces")]),e._v(" to verify your connection:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("a_user@cs-6000-devshell-vm-c34ef644-5584-4c5d-aa14-6e41af4a5c9a:~$ kubectl get namespaces\nNAME              STATUS   AGE\ndefault           Active   6m11s\nkube-node-lease   Active   6m12s\nkube-public       Active   6m12s\nkube-system       Active   6m13s\n\n")])])]),s("h3",{attrs:{id:"install-the-nginx-ingress-controller"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-the-nginx-ingress-controller"}},[e._v("#")]),e._v(" Install the NGINX Ingress Controller")]),e._v(" "),s("p",[e._v("Entando isn’t compatible out of the box  with the default ingress controller provided in GKE.\nSee here for more if you’re interested in GKE ingress: "),s("a",{attrs:{href:"https://cloud.google.com/kubernetes-engine/docs/concepts/ingress",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://cloud.google.com/kubernetes-engine/docs/concepts/ingress"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("We’re going to install the NGINX ingress controller to manage the ingresses for Entando services\ndeployed by the operator. This will be a simpler and more adaptable configuration for most users and\nenvironments. Users who really need the GKE ingress controller (rare) could integrate it following\nthe instructions provided by GKE and then customize the service definition created by the Entando\noperator.")]),e._v(" "),s("p",[e._v("These are the minimal instructions to prepare NGINX ingress using the Google Cloud Shell. To install it\nusing your local "),s("code",[e._v("kubectl")]),e._v(" or to vary other settings please see the more detailed documents here:\n"),s("a",{attrs:{href:"https://cloud.google.com/community/tutorials/nginx-ingress-gke",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://cloud.google.com/community/tutorials/nginx-ingress-gke"),s("OutboundLink")],1),e._v(" and "),s("a",{attrs:{href:"https://kubernetes.github.io/ingress-nginx/deploy/#gce-gke",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://kubernetes.github.io/ingress-nginx/deploy/#gce-gke"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("ol",[s("li",[e._v("Initialize your user as a cluster-admin:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl create clusterrolebinding cluster-admin-binding --clusterrole cluster-admin \\\n--user $(gcloud config get-value account)\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("Install the ingress controller pods:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/provider/cloud/deploy.yaml\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[e._v("To check if the ingress controller pods have started, run the following command:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("   kubectl get pods -n ingress-nginx \\\n     -l app.kubernetes.io/name=ingress-nginx --watch\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[e._v("Wait until the ingress-nginx-controller status changes to "),s("code",[e._v("Running")]),e._v(":")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("NAME                                        READY   STATUS      RESTARTS   AGE\ningress-nginx-admission-create-27tgt        0/1     Completed   0          65s\ningress-nginx-admission-patch-7wmgl         0/1     Completed   1          65s\ningress-nginx-controller-7656c59dc4-7xgmc   1/1     Running     0          75s\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[e._v("Get the external IP address for your ingress controller. Record the value of EXTERNAL-IP for "),s("code",[e._v("nginx-ingress-controller")]),e._v(" from the command below.")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl get service -n ingress-nginx\n")])])]),s("h3",{attrs:{id:"verify-the-nginx-ingress-install"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#verify-the-nginx-ingress-install"}},[e._v("#")]),e._v(" Verify the NGINX Ingress install")]),e._v(" "),s("p",[e._v("We recommend setting up a test application so you can easily verify the ingress is working.")]),e._v(" "),s("ol",[s("li",[e._v("From the "),s("code",[e._v("Cloud Shell,")]),e._v(" create a simple application by running the following command:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl run hello-app --generator=run-pod/v1 --image=gcr.io/google-samples/hello-app:1.0 --port=8080\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("Expose the "),s("code",[e._v("hello-app")]),e._v(" Pod as a Service:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl expose pod hello-app\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[e._v("Create an "),s("code",[e._v("ingress-resource.yaml")]),e._v(" file with this content:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('apiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-resource\n  annotations:\n    kubernetes.io/ingress.class: nginx\n    nginx.ingress.kubernetes.io/ssl-redirect: "false"\nspec:\n  rules:\n  - http:\n      paths:\n      - path: /hello\n        backend:\n          serviceName: hello-app\n          servicePort: 8080\n')])])]),s("ol",{attrs:{start:"4"}},[s("li",[e._v("Now create the Ingress Resource using "),s("code",[e._v("kubectl apply -f ingress-resource.yaml")])]),e._v(" "),s("li",[e._v("Verify that the Ingress Resource has been created using "),s("code",[e._v("kubectl get ingress ingress-resource")]),e._v(".\nIt may take a few minutes for the "),s("code",[e._v("Address")]),e._v(" to be populated.")]),e._v(" "),s("li",[e._v("Verify you can access the web application by going to the "),s("code",[e._v("EXTERNAL-IP/hello")]),e._v(" address, using the\n"),s("code",[e._v("Address")]),e._v(" from the previous nginx-ingress-controller. You should see the following:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Hello, world!\nVersion: 1.0.0\nHostname: hello-app\n")])])]),s("p",[e._v("Note the external IP address of your ingress controller since you’ll need it for the application configuration.\nThe Entando deployment exposes an environment variable to set the ingress controller to be used as part of the deployment. That variable is "),s("code",[e._v("ENTANDO_INGRESS_CLASS")]),e._v(" and should be set to "),s("code",[e._v("nginx")]),e._v(" in deployments to GKE (this is documented in the application instructions below as well)")]),e._v(" "),s("h2",{attrs:{id:"deploy-your-entando-application"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploy-your-entando-application"}},[e._v("#")]),e._v(" Deploy Your Entando Application")]),e._v(" "),s("p",[e._v("You can now deploy your Entando applications to GKE.")]),e._v(" "),s("h3",{attrs:{id:"setup-and-deploy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setup-and-deploy"}},[e._v("#")]),e._v(" Setup and Deploy")]),e._v(" "),s("ol",[s("li",[e._v("Download and unpack the entando-helm-quickstart:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("curl -sfL https://github.com/entando-k8s/entando-helm-quickstart/archive/v6.3.2.tar.gz | tar xvz\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("Deploy the Entando Kubernetes custom resources and configuration")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl apply -n [your-sandbox-namespace] -f https://raw.githubusercontent.com/entando-k8s/entando-k8s-operator-bundle/v6.3.2/manifests/k8s-116-and-later/namespace-scoped-deployment/all-in-one.yaml\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[e._v("In the entando-helm-quickstart edit this file "),s("code",[e._v("sample-configmaps/entando-operator-config.yaml")])]),e._v(" "),s("li",[e._v("Add these properties to the file (taking note of correct yaml spacing):")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('  entando.requires.filesystem.group.override: "true"\n  entando.ingress.class: "nginx"\n')])])]),s("ol",{attrs:{start:"5"}},[s("li",[e._v("Find this property in the file "),s("code",[e._v("entando.default.routing.suffix:")])]),e._v(" "),s("li",[e._v("Change the value to "),s("code",[e._v("<your nginx ip>.nip.io")]),e._v(". For example, "),s("code",[e._v("entando.default.routing.suffix: 35.232.231.65.nip.io")])]),e._v(" "),s("li",[e._v("Deploy the operator configuration")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl apply -f sample-configmaps/entando-operator-config.yaml -n [your namespace]\n")])])]),s("ol",{attrs:{start:"8"}},[s("li",[e._v("Open values.yaml in the "),s("code",[e._v("entando-helm-quickstart")])]),e._v(" "),s("li",[e._v("Changed the dbms from "),s("code",[e._v("embedded")]),e._v(" to "),s("code",[e._v("postgresql")])]),e._v(" "),s("li",[e._v("Deploy your Entando application")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("helm template --name=quickstart ./ | kubectl apply -n [your-sandbox-namespace] -f -\n")])])]),s("ol",{attrs:{start:"9"}},[s("li",[e._v("Watch the deployment for completion")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("watch kubectl get pods -n [your-sandbox-namespace]\n")])])]),s("p",[e._v("Watch Entando startup. The application will be available when the "),s("code",[e._v("quickstart-composite-app-deployer")]),e._v(" pod has a status of completed")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("NAME                                                 READY   STATUS      RESTARTS   AGE\nmy-aks-app-operator-644697776f-sxtq2                 1/1     Running     0          13m\nquickstart-composite-app-deployer-2guz0n42pc         1/1     Running     0          13m\nquickstart-deployer-jj4njqk4bg                       1/1     Running     0          10m\nquickstart-eci-deployer-t0xktqsonk                   0/1     Completed   0          11m\nquickstart-eci-k8s-svc-deployment-78f64c8d89-7c578   1/1     Running     0          11m\nquickstart-kc-deployer-16gzv3clsj                    0/1     Completed   0          13m\nquickstart-kc-server-deployment-7c9bc65744-g52nx     1/1     Running     0          13m\nquickstart-server-deployment-55fcfc6b68-szvkl        0/3     Pending     0          10m\n")])])]),s("h2",{attrs:{id:"tls-notes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tls-notes"}},[e._v("#")]),e._v(" TLS Notes")]),e._v(" "),s("p",[e._v("If you have configured TLS related to the ingress for the ECI service")]),e._v(" "),s("ol",[s("li",[e._v("After the installation patch the ingress path for the ECI to include a trailing slash")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('kubectl -n {NAMESPACE} patch ingress quickstart-eci-ingress --type=\'json\' -p=\'[{"op": "replace", "path": "/spec/rules/0/http/paths/0/path", "value":"/k8s/"}]\'\ningress.extensions/quickstart-eci-ingress patched\n')])])]),s("h2",{attrs:{id:"workaround-for-invalid-login-form-redirect-when-using-tls"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#workaround-for-invalid-login-form-redirect-when-using-tls"}},[e._v("#")]),e._v(" Workaround for invalid login form, redirect when using TLS")]),e._v(" "),s("ol",[s("li",[e._v("In your application manifest add")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kind: EntandoCompositeApp\nspec:\n  components:\n  - kind: EntandoKeycloakServer\n    spec:\n      environmentVariables:\n        - name: APPLICATIONBASEURL\n          value: https://{HOSTNAME}/entando-de-app/\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("In App Builder under "),s("code",[e._v("Pages → Settings")]),e._v(" set "),s("code",[e._v("Base URL")]),e._v(" to "),s("code",[e._v("Static")])])]),e._v(" "),s("h3",{attrs:{id:"appendix-a-configuring-clustered-storage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#appendix-a-configuring-clustered-storage"}},[e._v("#")]),e._v(" Appendix A: Configuring Clustered Storage")]),e._v(" "),s("p",[e._v("In order to scale an Entando Application across multiple nodes you must provide a storage class that supports\na "),s("code",[e._v("ReadWriteMany")]),e._v(" access policy. There are many ways to accomplish this including using dedicated storage providers\nlike GlusterFS or others.")]),e._v(" "),s("p",[e._v("The instructions below provide an example of configuring using the GCP Cloud Filestore to provide the clustered storage\nbut if you have an existing enterprise clustered file solution and you can expose it as a StorageClass it is recommended to\nuse and test that configuration.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),s("p",[e._v("You can also scale an Entando Application without clustered storage using a "),s("code",[e._v("ReadWriteOnce (RWO)")]),e._v(" policy by ensuring that the\ninstances are all scheduled to the same node. This can be accomplished using taints on other nodes. Be aware of the pros and cons of scheduling\ninstances to the same node. This will give you protection if the application instance itself dies or becomes unreachable and will help\nyou get the most utilization of node resources. However, if the node dies or is shutdown you will have to wait for Kubernetes to reschedule the pods to a different node and your application will be down.")])]),e._v(" "),s("h4",{attrs:{id:"clustered-storage-using-gcp-cloud-filestore"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#clustered-storage-using-gcp-cloud-filestore"}},[e._v("#")]),e._v(" Clustered Storage Using GCP Cloud Filestore")]),e._v(" "),s("ol",[s("li",[e._v("In the GCP portal in the left menu find the Storage section and select "),s("code",[e._v("Filestore -> Instances")])]),e._v(" "),s("li",[e._v("Enable the Filestore if you haven't already")]),e._v(" "),s("li",[e._v("Select Create Instance")]),e._v(" "),s("li",[e._v("Fill in the fields keeping the defaults or updating to fit your specific needs. Remember your Instance ID")]),e._v(" "),s("li",[e._v("Once the instance is created on the Filestore main page note the IP address of your NFS")]),e._v(" "),s("li",[e._v("Now install the provisioner that will  create the StorageClass that will allow deployment of Entando Applications using the commands below replacing\n"),s("code",[e._v("[your nfs ip]")]),e._v(" and "),s("code",[e._v("[your nfs path]")]),e._v(" with the IP address of your cluster and with the instance ID you chose above.")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("helm install nfs-subdir-external-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \\\n    --set nfs.server=[your nfs ip] \\\n    --set nfs.path=[your nfs path]\n")])])]),s("p",[e._v("Read more about the provisioner and additional configuration options here:\nhttps://github.com/kubernetes-sigs/nfs-subdir-external-provisioner")]),e._v(" "),s("ol",{attrs:{start:"7"}},[s("li",[e._v("Check to ensure your client provisioned successfully")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl get sc\n")])])]),s("p",[e._v("Looking for the storage class with a name of "),s("code",[e._v("nfs-client")]),e._v(". For example,")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("NAME                 PROVISIONER                                     RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE\nnfs-client           cluster.local/nfs-subdir-external-provisioner   Delete          Immediate              true                   37m\npremium-rwo          pd.csi.storage.gke.io                           Delete          WaitForFirstConsumer   true                   27h\nstandard (default)   kubernetes.io/gce-pd                            Delete          Immediate              true                   27h\nstandard-rwo         pd.csi.storage.gke.io                           Delete          WaitForFirstConsumer   true                   27h\n")])])]),s("ol",{attrs:{start:"8"}},[s("li",[e._v("In your operator config map add these two variables:")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('entando.k8s.operator.default.clustered.storage.class: "nfs-client"\nentando.k8s.operator.default.non.clustered.storage.class: "standard"\n')])])]),s("ol",{attrs:{start:"9"}},[s("li",[e._v("Deploy your Entando Application using the instructions above and the server instances will\nautomatically use the clustered storage.")])])])}),[],!1,null,null,null);t.default=n.exports}}]);